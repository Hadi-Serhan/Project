<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mage Core</title>
  <link rel="stylesheet" href="style.css">
  <!-- Silence favicon 404 in dev -->
  <link rel="icon" href="data:,">
</head>
<body>
<div id="wrap">
  <canvas id="game"></canvas>

  <!-- Vue UI (everything reactive lives inside #app) -->
  <div id="app" class="ui">

    <!-- Top HUD (inside #app so {{ }} works) -->
    <div class="hud">
      <div class="hud-group">
        <span class="tag">Wave</span>
        <span class="hud-val">{{ wave }}</span>
      </div>
      <div class="hud-group">
        <span class="tag">Core HP</span>
        <span class="hud-val">{{ coreHP }}</span>
      </div>
      <div class="hud-group">
        <span class="tag">Gold</span>
        <span class="hud-val">{{ gold }}</span>
      </div>
      <div class="hud-status">{{ waveStatus }}</div>
    </div>

    <!-- Controls -->
    <div class="card controls">
      <div class="row wrap">
        <button class="btn primary"
                @click="startWave" :disabled="waveRunning || defeated">Start Wave</button>

        <button class="btn"
                :class="{warning: paused}"
                @click="togglePause">{{ paused ? 'Resume' : 'Pause' }}</button>

        <label class="control">
          <span class="lbl">Speed</span>
          <select v-model.number="timeScale" @change="setSpeed(timeScale)">
            <option :value="1">x1</option>
            <option :value="2">x2</option>
            <option :value="3">x3</option>
            <option :value="4">x4</option>
          </select>
        </label>

        <label class="control chk">
          <input type="checkbox" v-model="autoStart" @change="setAutoStart(autoStart)" />
          <span>Auto-start next wave</span>
        </label>

        <button class="btn ghost" @click="reset">Reset</button>
      </div>

      <div class="row wrap">
        <button class="btn ghost" @click="saveNow">Save</button>
        <button class="btn ghost" @click="loadSave" :disabled="!hasSave">Load</button>
        <button class="btn ghost danger" @click="wipeSave" :disabled="!hasSave">Wipe</button>
        <span class="meta">Last saved: {{ lastSavedLabel }}</span>
      </div>
    </div>

    <!-- Upgrades -->
    <div class="card">
      <h3>Upgrades</h3>
      <div class="grid3">
        <div class="upgrade">
          <div class="u-title">Damage</div>
          <button class="btn block"
                  @click="buy('dmg')"
                  :disabled="gold < costs.dmg">Buy ({{ costs.dmg }})</button>
        </div>
        <div class="upgrade">
          <div class="u-title">Fire Rate</div>
          <button class="btn block"
                  @click="buy('rof')"
                  :disabled="gold < costs.rof">Buy ({{ costs.rof }})</button>
        </div>
        <div class="upgrade">
          <div class="u-title">Range</div>
          <button class="btn block"
                  @click="buy('range')"
                  :disabled="gold < costs.range">Buy ({{ costs.range }})</button>
        </div>
        <div class="upgrade">
          <div class="u-title">Haste+</div>
          <button class="btn block"
                  @click="buy('haste_plus')"
                  :disabled="gold < costs.haste_plus">Buy ({{ costs.haste_plus }})</button>
        </div>
      </div>
    </div>

    <!-- Abilities -->
    <div class="card">
      <h3>Abilities</h3>
      <div class="row wrap">
        <button class="btn ability"
                :class="{cooling: cd.nova > 0}"
                @click="cast('nova')"
                :disabled="cd.nova > 0">
          Fire Nova <span class="hint">(Q)</span>
          <span class="cooldown" v-if="cd.nova > 0">{{ cd.nova.toFixed(1) }}s</span>
        </button>

        <button class="btn ability"
                :class="{cooling: cd.frost > 0}"
                @click="cast('frost')"
                :disabled="cd.frost > 0">
          Frost Dome <span class="hint">(W)</span>
          <span class="cooldown" v-if="cd.frost > 0">{{ cd.frost.toFixed(1) }}s</span>
        </button>
      </div>
    </div>

  </div>
</div>

<!-- Vue -->
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

<!-- Bootstrap: load mods first, then the game and UI -->
<script type="module">
  import { loadAllMods } from './mage-core/src/mod-loader.js';
  try {
    await loadAllMods();                 // 1) load /mods/*.js listed in mod-loader
  } catch (e) {
    console.warn('[bootstrap] mod loading failed:', e);
  }
  await import('./mage-core/src/main.js');         // 2) boot the engine/game
  await import('./mage-core/src/ui/vue-app.js');   // 3) mount the Vue UI (dynamic lists)
</script>
</body>
</html>
